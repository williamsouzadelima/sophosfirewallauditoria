# Strati Audit System üõ°Ô∏è

Sistema de auditoria de seguran√ßa para firewalls Sophos, desenvolvido para automatizar e centralizar auditorias de seguran√ßa em infraestruturas empresariais.

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![Flask](https://img.shields.io/badge/Flask-2.3+-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)
![Security](https://img.shields.io/badge/Security-Audit-red.svg)

## üìã √çndice

- [Caracter√≠sticas](#-caracter√≠sticas)
- [Pr√©-requisitos](#-pr√©-requisitos)
- [Instala√ß√£o R√°pida](#-instala√ß√£o-r√°pida)
- [Instala√ß√£o Manual](#-instala√ß√£o-manual)
- [Configura√ß√£o](#-configura√ß√£o)
- [Uso](#-uso)
- [API](#-api)
- [Integra√ß√£o Sophos](#-integra√ß√£o-sophos)
- [Seguran√ßa](#-seguran√ßa)
- [Monitoramento](#-monitoramento)
- [Backup e Recupera√ß√£o](#-backup-e-recupera√ß√£o)
- [Solu√ß√£o de Problemas](#-solu√ß√£o-de-problemas)
- [Contribui√ß√£o](#-contribui√ß√£o)

## üöÄ Caracter√≠sticas

### Core Features
- ‚úÖ **Auditoria Automatizada**: Integra√ß√£o com [Sophos Firewall Audit](https://github.com/sophos/sophos-firewall-audit)
- üéØ **Multi-Cliente**: Gerenciamento de m√∫ltiplos clientes e firewalls
- üìä **Dashboard Interativo**: Interface web moderna e responsiva
- üìà **Relat√≥rios Detalhados**: Gera√ß√£o autom√°tica de relat√≥rios HTML/JSON
- üîê **Autentica√ß√£o JWT**: Sistema seguro de autentica√ß√£o
- üì± **Mobile Friendly**: Interface otimizada para dispositivos m√≥veis

### Security Features
- üõ°Ô∏è **An√°lise de Pol√≠ticas**: Verifica√ß√£o de pol√≠ticas de seguran√ßa
- üîç **Configura√ß√£o do Sistema**: Auditoria de configura√ß√µes cr√≠ticas
- üåê **Configura√ß√µes de Rede**: An√°lise de configura√ß√µes de rede
- üë§ **Autentica√ß√£o de Usu√°rios**: Verifica√ß√£o de configura√ß√µes de usu√°rio
- üìù **Configura√ß√£o de Logs**: Auditoria de configura√ß√µes de logging
- üîÑ **Status de Atualiza√ß√µes**: Verifica√ß√£o de atualiza√ß√µes de sistema
- üìú **Valida√ß√£o de Certificados**: Verifica√ß√£o de certificados SSL/TLS
- üö´ **Preven√ß√£o de Intrus√£o**: An√°lise de sistemas IPS
- üåê **Filtro Web**: Verifica√ß√£o de configura√ß√µes de filtro web
- üì± **Controle de Aplica√ß√µes**: Auditoria de controle de aplica√ß√µes

### Management Features
- üë• **Gerenciamento de Usu√°rios**: Sistema de roles e permiss√µes
- üìä **M√©tricas de Performance**: Acompanhamento de scores de seguran√ßa
- üîÑ **Execu√ß√£o Agendada**: Auditorias programadas
- üíæ **Backup Autom√°tico**: Sistema de backup automatizado
- üìß **Alertas por Email**: Notifica√ß√µes autom√°ticas
- üîç **Logs Detalhados**: Sistema de logging abrangente

## üìã Pr√©-requisitos

### Sistema Operacional
- Linux (Ubuntu 20.04+, CentOS 8+, RHEL 8+)
- macOS 10.15+
- Windows 10+ (via WSL2)

### Software
```bash
# Essenciais
python3 (3.8+)
python3-pip
python3-venv
git
openssh-client

# Opcionais
docker
nginx (para produ√ß√£o)
postgresql (para produ√ß√£o)
```

### Recursos de Sistema
```
RAM: 2GB m√≠nimo, 4GB recomendado
CPU: 2 cores m√≠nimo
Disco: 10GB espa√ßo livre
Rede: Acesso SSH aos firewalls Sophos
```

### Acesso aos Firewalls
- Usu√°rio administrativo nos firewalls Sophos
- Acesso SSH habilitado (porta 4444 padr√£o)
- Conectividade de rede entre o sistema e os firewalls

## üöÄ Instala√ß√£o R√°pida

### M√©todo 1: Script Automatizado (Recomendado)

```bash
# 1. Clonar o reposit√≥rio
git clone https://github.com/seu-usuario/strati-audit-system.git
cd strati-audit-system

# 2. Executar instala√ß√£o automatizada
chmod +x setup.sh
./setup.sh

# 3. Iniciar o sistema
./scripts/start.sh
```

### M√©todo 2: Docker (Mais Simples)

```bash
# 1. Clonar e construir
git clone https://github.com/seu-usuario/strati-audit-system.git
cd strati-audit-system

# 2. Construir imagem
docker build -t strati-audit .

# 3. Executar container
docker run -d \
  --name strati-audit \
  -p 8080:8080 \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/logs:/app/logs \
  strati-audit
```

## üîß Instala√ß√£o Manual

### 1. Preparar Ambiente

```bash
# Clonar reposit√≥rio
git clone https://github.com/seu-usuario/strati-audit-system.git
cd strati-audit-system

# Criar estrutura de diret√≥rios
mkdir -p {clients,reports,logs,backups,config,scripts}
mkdir -p data/{databases,temp}
```

### 2. Configurar Python

```bash
# Criar ambiente virtual
python3 -m venv venv
source venv/bin/activate

# Instalar depend√™ncias
pip install --upgrade pip
pip install -r requirements.txt
```

### 3. Baixar Sophos Firewall Audit

```bash
# Clonar reposit√≥rio oficial
git clone https://github.com/sophos/sophos-firewall-audit.git
chmod +x sophos-firewall-audit/sophos_firewall_audit.py
```

### 4. Configurar Banco de Dados

```bash
# Ativar ambiente virtual
source venv/bin/activate

# Inicializar banco
python3 -c "from app import init_database; init_database()"
```

### 5. Configurar Vari√°veis de Ambiente

```bash
# Criar arquivo .env
cp .env.example .env
nano .env
```

### 6. Iniciar Sistema

```bash
# M√©todo desenvolvimento
python3 app.py

# M√©todo produ√ß√£o
gunicorn --bind 0.0.0.0:8080 --workers 4 app:app
```

## ‚öôÔ∏è Configura√ß√£o

### Arquivo .env

```bash
# Flask Configuration
FLASK_ENV=production
FLASK_DEBUG=False
SECRET_KEY=sua_chave_secreta_aqui

# Database
DATABASE_PATH=./data/databases/strati_audit.db

# Sophos Audit
SOPHOS_AUDIT_SCRIPT=./sophos-firewall-audit/sophos_firewall_audit.py

# Security
JWT_EXPIRATION_HOURS=24
BCRYPT_ROUNDS=12

# Network
HOST=0.0.0.0
PORT=8080

# Email (opcional)
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=seu_email@gmail.com
SMTP_PASSWORD=sua_senha_app
ALERT_EMAIL=admin@empresa.com
```

### Configura√ß√£o de Usu√°rios

O sistema vem com usu√°rios padr√£o:

```
Usu√°rio: admin
Senha: admin123
Role: admin

```

**‚ö†Ô∏è IMPORTANTE**: Altere as senhas padr√£o imediatamente ap√≥s a instala√ß√£o!

### Configura√ß√£o de Firewalls

1. Acesse o dashboard web
2. Clique em "Novo Cliente"
3. Preencha os dados do cliente
4. Adicione os firewalls com:
   - Hostname/IP
   - Porta SSH (geralmente 4444)
   - Credenciais de acesso

## üìñ Uso

### Dashboard Web

Acesse: `http://localhost:8080`

#### Funcionalidades Principais:

1. **Gerenciamento de Clientes**
   - Adicionar novos clientes
   - Configurar firewalls por cliente
   - Visualizar estat√≠sticas

2. **Execu√ß√£o de Auditorias**
   - Auditorias sob demanda
   - Sele√ß√£o de cliente espec√≠fico
   - Monitoramento em tempo real

3. **Relat√≥rios**
   - Visualiza√ß√£o online
   - Download em HTML
   - Hist√≥rico de auditorias

4. **Monitoramento**
   - Dashboard com m√©tricas
   - Scores de seguran√ßa
   - Alertas autom√°ticos

### Scripts de Linha de Comando

```bash
# Iniciar sistema
./scripts/start.sh

# Parar sistema
./scripts/stop.sh

# Monitorar sistema
./scripts/monitor.sh

# Fazer backup
./scripts/backup.sh

# Restaurar backup
./scripts/restore.sh backup_file.tar.gz

# Atualizar sistema
./scripts/update.sh

# Instalar como servi√ßo
sudo ./scripts/install_service.sh
```

### Execu√ß√£o via API

```python
import requests

# Login
response = requests.post('http://localhost:8080/api/auth/login', 
                        json={'username': 'admin', 'password': 'admin123'})
token = response.json()['token']

# Executar auditoria
headers = {'Authorization': f'Bearer {token}'}
response = requests.post('http://localhost:8080/api/audits/run',
                        json={'client_id': 1}, 
                        headers=headers)

audit_id = response.json()['audit_id']
print(f"Auditoria iniciada: {audit_id}")
```

## üîå API

### Autentica√ß√£o

```bash
# Login
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'
```

### Clientes

```bash
# Listar clientes
curl -X GET http://localhost:8080/api/clients \
  -H "Authorization: Bearer TOKEN"

# Criar cliente
curl -X POST http://localhost:8080/api/clients \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Empresa ABC",
    "description": "Cliente teste",
    "firewalls": [
      {
        "hostname": "192.168.1.1",
        "port": 4444,
        "username": "admin"
      }
    ]
  }'
```

### Auditorias

```bash
# Executar auditoria
curl -X POST http://localhost:8080/api/audits/run \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"client_id": 1}'

# Listar auditorias
curl -X GET http://localhost:8080/api/audits \
  -H "Authorization: Bearer TOKEN"
```

### Relat√≥rios

```bash
# Listar relat√≥rios
curl -X GET http://localhost:8080/api/reports \
  -H "Authorization: Bearer TOKEN"

# Download relat√≥rio
curl -X GET http://localhost:8080/api/reports/audit_1/download \
  -H "Authorization: Bearer TOKEN" \
  -o relatorio.html
```

## üõ°Ô∏è Integra√ß√£o Sophos

O sistema utiliza o projeto oficial [Sophos Firewall Audit](https://github.com/sophos/sophos-firewall-audit) para realizar as auditorias.

### Verifica√ß√µes Realizadas

1. **Pol√≠ticas de Seguran√ßa**
   - Regras de firewall
   - Pol√≠ticas de acesso
   - Configura√ß√µes de NAT

2. **Configura√ß√£o do Sistema**
   - Configura√ß√µes administrativas
   - Configura√ß√µes de tempo
   - Configura√ß√µes de SNMP

3. **Seguran√ßa de Rede**
   - Configura√ß√µes de interface
   - VPN settings
   - Wireless security

4. **Autentica√ß√£o**
   - Configura√ß√µes de usu√°rio
   - Integra√ß√£o LDAP/AD
   - Pol√≠ticas de senha

5. **Logging e Monitoramento**
   - Configura√ß√µes de syslog
   - Alertas de seguran√ßa
   - Reten√ß√£o de logs

### Personaliza√ß√£o de Verifica√ß√µes

```python
# Exemplo de configura√ß√£o personalizada
audit_config = {
    'checks': {
        'security_policies': True,
        'system_configuration': True,
        'network_settings': False,  # Desabilitar
        'user_authentication': True,
        'logging_configuration': True,
        # ... outras verifica√ß√µes
    }
}
```

## üîê Seguran√ßa

### Autentica√ß√£o e Autoriza√ß√£o

- **JWT Tokens**: Autentica√ß√£o baseada em tokens
- **Bcrypt**: Hash seguro de senhas
- **Role-based Access**: Sistema de permiss√µes por fun√ß√£o
- **Session Management**: Controle de sess√µes ativas

### Prote√ß√£o de Dados

- **Criptografia**: Credenciais criptografadas no banco
- **SSL/TLS**: Suporte para conex√µes seguras
- **Input Validation**: Valida√ß√£o rigorosa de entradas
- **SQL Injection Protection**: Prepared statements

### Boas Pr√°ticas

```bash
# 1. Alterar senhas padr√£o
# 2. Configurar SSL/TLS em produ√ß√£o
# 3. Usar banco PostgreSQL em produ√ß√£o
# 4. Configurar firewall adequadamente
# 5. Manter sistema atualizado
# 6. Monitorar logs regularmente
# 7. Fazer backups regulares
```

### Configura√ß√£o SSL/TLS

```nginx
# Configura√ß√£o Nginx para produ√ß√£o
server {
    listen 443 ssl;
    server_name seu-dominio.com;
    
    ssl_certificate /path/to/certificate.crt;
    ssl_certificate_key /path/to/private.key;
    
    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## üìä Monitoramento

### M√©tricas do Sistema

```bash
# Status geral
./scripts/monitor.sh

# Logs em tempo real
tail -f logs/strati_audit.log

# Performance do banco
sqlite3 data/databases/strati_audit.db ".schema"
```

### Alertas Autom√°ticos

O sistema pode enviar alertas por email para:

- Falhas em auditorias
- Scores baixos de seguran√ßa
- Problemas t√©cnicos
- Atualiza√ß√µes importantes

### Health Checks

```bash
# Verificar se aplica√ß√£o est√° respondendo
curl -f http://localhost:8080/api/health || echo "Sistema indispon√≠vel"

# Verificar banco de dados
sqlite3 data/databases/strati_audit.db "PRAGMA integrity_check;"
```

## üíæ Backup e Recupera√ß√£o

### Backup Autom√°tico

```bash
# Configurar backup autom√°tico (crontab)
0 2 * * * /path/to/strati-audit/scripts/backup.sh

# Backup manual
./scripts/backup.sh
```

### Restaura√ß√£o

```bash
# Listar backups dispon√≠veis
ls -la backups/

# Restaurar backup espec√≠fico
./scripts/restore.sh backups/strati_backup_20231201_020000.tar.gz
```

### Estrat√©gia de Backup

1. **Backup Di√°rio**: Dados completos √†s 02:00
2. **Backup Incremental**: A cada 6 horas
3. **Reten√ß√£o**: 30 dias para backups locais
4. **Backup Remoto**: Configura√ß√£o opcional

## üêõ Solu√ß√£o de Problemas

### Problemas Comuns

#### 1. Erro de Conex√£o com Firewall

```bash
# Verificar conectividade
telnet IP_FIREWALL 4444

# Testar SSH
ssh -p 4444 admin@IP_FIREWALL

# Verificar logs
tail -f logs/strati_audit.log | grep -i error
```

#### 2. Banco de Dados Corrompido

```bash
# Verificar integridade
sqlite3 data/databases/strati_audit.db "PRAGMA integrity_check;"

# Reparar se necess√°rio
./scripts/restore.sh backup_recente.tar.gz
```

#### 3. Problemas de Autentica√ß√£o

```bash
# Resetar senha admin
python3 -c "
from app import *
import sqlite3
from werkzeug.security import generate_password_hash

conn = sqlite3.connect('data/databases/strati_audit.db')
cursor = conn.cursor()
new_password = generate_password_hash('nova_senha')
cursor.execute('UPDATE users SET password_hash = ? WHERE username = ?', 
               (new_password, 'admin'))
conn.commit()
conn.close()
print('Senha alterada com sucesso')
"
```

#### 4. Performance Lenta

```bash
# Verificar recursos do sistema
top
df -h
free -m

# Otimizar banco de dados
sqlite3 data/databases/strati_audit.db "VACUUM;"
```

### Logs de Debug

```bash
# Ativar modo debug
export FLASK_DEBUG=True

# Logs detalhados
tail -f logs/strati_audit.log logs/error.log

# Logs de acesso
tail -f logs/access.log
```

### Suporte

Para suporte t√©cnico:

1. Verificar logs de erro
2. Executar script de diagn√≥stico: `./scripts/monitor.sh`
3. Coletar informa√ß√µes do sistema
4. Abrir issue no GitHub com detalhes

## ü§ù Contribui√ß√£o

### Como Contribuir

1. **Fork** o reposit√≥rio
2. **Clone** seu fork localmente
3. Crie uma **branch** para sua feature
4. **Commit** suas mudan√ßas
5. **Push** para sua branch
6. Abra um **Pull Request**

### Desenvolvimento

```bash
# Configurar ambiente de desenvolvimento
git clone https://github.com/seu-usuario/strati-audit-system.git
cd strati-audit-system

# Instalar depend√™ncias de desenvolvimento
pip install -r requirements-dev.txt

# Executar testes
pytest

# Verificar c√≥digo
flake8 app.py
black app.py
```

### Padr√µes de C√≥digo

- **Python**: PEP 8
- **JavaScript**: ESLint
- **CSS**: Prettier
- **Commits**: Conventional Commits

### Estrutura do Projeto

```
strati-audit-system/
‚îú‚îÄ‚îÄ app.py                 # Aplica√ß√£o principal
‚îú‚îÄ‚îÄ sophos_audit_integration.py  # Integra√ß√£o Sophos
‚îú‚îÄ‚îÄ requirements.txt       # Depend√™ncias Python
‚îú‚îÄ‚îÄ setup.sh              # Script de instala√ß√£o
‚îú‚îÄ‚îÄ .env.example          # Exemplo de configura√ß√£o
‚îú‚îÄ‚îÄ README.md             # Documenta√ß√£o
‚îú‚îÄ‚îÄ scripts/              # Scripts de automa√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ start.sh
‚îÇ   ‚îú‚îÄ‚îÄ stop.sh
‚îÇ   ‚îú‚îÄ‚îÄ monitor.sh
‚îÇ   ‚îî‚îÄ‚îÄ backup.sh
‚îú‚îÄ‚îÄ config/               # Arquivos de configura√ß√£o
‚îú‚îÄ‚îÄ data/                 # Dados do sistema
‚îÇ   ‚îî‚îÄ‚îÄ databases/
‚îú‚îÄ‚îÄ logs/                 # Logs do sistema
‚îú‚îÄ‚îÄ reports/              # Relat√≥rios gerados
‚îú‚îÄ‚îÄ backups/              # Backups do sistema
‚îî‚îÄ‚îÄ sophos-firewall-audit/ # Projeto oficial Sophos
```

## üìù Changelog

### v1.0.0 (2023-12-01)
- ‚ú® Lan√ßamento inicial
- üõ°Ô∏è Integra√ß√£o com Sophos Firewall Audit
- üìä Dashboard web responsivo
- üîê Sistema de autentica√ß√£o JWT
- üìà Gera√ß√£o de relat√≥rios HTML
- üë• Gerenciamento multi-cliente
- üíæ Sistema de backup automatizado

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa MIT - veja o arquivo [LICENSE](LICENSE) para detalhes.

## üìû Contato

- **Autor**: Strati Security Team
- **Email**: contato@strati.com.br
- **Website**: https://strati.com.br
- **GitHub**: https://github.com/strati-security

## üôè Agradecimentos

- **Sophos**: Pelo projeto open source [Sophos Firewall Audit](https://github.com/sophos/sophos-firewall-audit)
- **Flask Team**: Pelo excelente framework web
- **Comunidade Python**: Pelas bibliotecas utilizadas
- **Contribuidores**: Todos que ajudaram no desenvolvimento

---

**‚ö†Ô∏è Aviso de Seguran√ßa**: Este sistema lida com informa√ß√µes sens√≠veis de seguran√ßa. Use sempre em ambientes seguros e mantenha-o atualizado.

**üìö Documenta√ß√£o Adicional**: Para mais detalhes t√©cnicos, consulte a [Wiki do projeto](https://github.com/seu-usuario/strati-audit-system/wiki).
